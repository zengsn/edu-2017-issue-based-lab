{
  "committer" : {
    "login" : "web-flow",
    "id" : 19864447,
    "avatar_url" : "https://avatars.githubusercontent.com/u/19864447?v=3",
    "gravatar_id" : "",
    "url" : "https://api.github.com/users/web-flow",
    "html_url" : "https://github.com/web-flow",
    "followers_url" : "https://api.github.com/users/web-flow/followers",
    "following_url" : "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url" : "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url" : "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url" : "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url" : "https://api.github.com/users/web-flow/orgs",
    "repos_url" : "https://api.github.com/users/web-flow/repos",
    "events_url" : "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url" : "https://api.github.com/users/web-flow/received_events",
    "type" : "User",
    "site_admin" : false
  },
  "stats" : {
    "total" : 762,
    "additions" : 762,
    "deletions" : 0
  },
  "author" : {
    "login" : "zengsn",
    "id" : 627946,
    "avatar_url" : "https://avatars.githubusercontent.com/u/627946?v=3",
    "gravatar_id" : "",
    "url" : "https://api.github.com/users/zengsn",
    "html_url" : "https://github.com/zengsn",
    "followers_url" : "https://api.github.com/users/zengsn/followers",
    "following_url" : "https://api.github.com/users/zengsn/following{/other_user}",
    "gists_url" : "https://api.github.com/users/zengsn/gists{/gist_id}",
    "starred_url" : "https://api.github.com/users/zengsn/starred{/owner}{/repo}",
    "subscriptions_url" : "https://api.github.com/users/zengsn/subscriptions",
    "organizations_url" : "https://api.github.com/users/zengsn/orgs",
    "repos_url" : "https://api.github.com/users/zengsn/repos",
    "events_url" : "https://api.github.com/users/zengsn/events{/privacy}",
    "received_events_url" : "https://api.github.com/users/zengsn/received_events",
    "type" : "User",
    "site_admin" : false
  },
  "html_url" : "https://github.com/hzuapps/android-labs/commit/1c4dd09b3992c3b72491ca312a6b0198b60db831",
  "commit" : {
    "author" : {
      "name" : "Zeng Shaoning",
      "email" : "shaoning.zeng@gmail.com",
      "date" : "2016-06-17T02:09:27Z"
    },
    "committer" : {
      "name" : "GitHub",
      "email" : "noreply@github.com",
      "date" : "2016-06-17T02:09:27Z"
    },
    "message" : "Merge pull request #984 from liangchuxian/master\n\n#983 #1 #88 #89 #90 #95 lab1 lab2 lab3 lab4 lab9",
    "tree" : {
      "sha" : "a749b58cc2fbbaf57bcf2f8424e2a0b064ae5a5e",
      "url" : "https://api.github.com/repos/hzuapps/android-labs/git/trees/a749b58cc2fbbaf57bcf2f8424e2a0b064ae5a5e"
    },
    "url" : "https://api.github.com/repos/hzuapps/android-labs/git/commits/1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "comment_count" : 0
  },
  "comments_url" : "https://api.github.com/repos/hzuapps/android-labs/commits/1c4dd09b3992c3b72491ca312a6b0198b60db831/comments",
  "files" : [ {
    "sha" : "73cfce6e4b68c76d955fb37611dd0d91f6939ce1",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DBHelper.java",
    "status" : "added",
    "additions" : 31,
    "deletions" : 0,
    "changes" : 31,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DBHelper.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DBHelper.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DBHelper.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,31 @@\n+package single_thread_download.skyward.com.db;\n+\n+import android.content.Context;\n+import android.database.sqlite.SQLiteDatabase;\n+import android.database.sqlite.SQLiteOpenHelper;\n+\n+/**\n+ * Created by skyward on 2016/6/15.\n+ */\n+public class DBHelper extends SQLiteOpenHelper {\n+    public static final int VERSION = 1;\n+    public static final String SQL_CREATE = \"create table thread_info(_id integer primary key,\" +\n+            \"thread_id integer,url text,start integer,end integer,finished integer)\";\n+    public static final String SQL_DROP = \"drop table if exists thread_info\";\n+    public static final String DB_NAME = \"download.db\";\n+\n+    public DBHelper(Context context) {\n+        super(context, DB_NAME, null, VERSION);\n+    }\n+\n+    @Override\n+    public void onCreate(SQLiteDatabase db) {\n+        db.execSQL(SQL_CREATE);\n+    }\n+\n+    @Override\n+    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n+        db.execSQL(SQL_DROP);\n+        db.execSQL(SQL_CREATE);\n+    }\n+}"
  }, {
    "sha" : "3fe2c904af4a26447910f368bb68653fa49e020d",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadService.java",
    "status" : "added",
    "additions" : 118,
    "deletions" : 0,
    "changes" : 118,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadService.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadService.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadService.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,118 @@\n+package single_thread_download.skyward.com.service;\n+\n+import android.app.Service;\n+import android.content.Intent;\n+import android.os.Bundle;\n+import android.os.Environment;\n+import android.os.Handler;\n+import android.os.IBinder;\n+import android.os.Message;\n+import android.text.LoginFilter;\n+import android.util.Log;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.net.HttpURLConnection;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+\n+import single_thread_download.skyward.com.bean.FileInfo;\n+\n+public class DownloadService extends Service {\n+    DownloadTask downloadTask = null;\n+    Handler mHandler = new Handler() {\n+        @Override\n+        public void handleMessage(Message msg) {\n+            switch (MSG_INIT) {\n+                case MSG_INIT:\n+                    FileInfo fileInfo = (FileInfo) msg.obj;\n+                    Log.i(TAG, \"handleMessage: \" + fileInfo);\n+                    downloadTask = new DownloadTask(DownloadService.this, fileInfo);\n+                    downloadTask.download();\n+                    break;\n+            }\n+        }\n+    };\n+    private static final String TAG = \"DownloadService\";\n+    public static final String ACTION_START = \"ACTION_START\";\n+    public static final String ACTION_STOP = \"ACTION_STOP\";\n+    public static final String ACTION_UPDATE = \"ACTION_UPDATE\";\n+    public static final int MSG_INIT = 0;\n+    public static final String DOWNLOAD_PATH = Environment.getExternalStorageDirectory().getAbsolutePath() + \"/download/\";\n+\n+    @Override\n+    public int onStartCommand(Intent intent, int flags, int startId) {\n+        String action = intent.getAction();\n+        //获得Activity传来的参数\n+        FileInfo fileInfo = (FileInfo) intent.getSerializableExtra(\"fileInfo\");\n+        if(action.equals(ACTION_START)) {\n+            Log.i(TAG, \"Start: \" + fileInfo.toString());\n+            new InitThread(fileInfo).start();\n+        } else if(action.equals(ACTION_STOP)) {\n+            Log.i(TAG, \"Stop: \" +fileInfo.toString());\n+            downloadTask.isPause = true;\n+        }\n+        return super.onStartCommand(intent, flags, startId);\n+    }\n+\n+    public DownloadService() {\n+    }\n+\n+    @Override\n+    public IBinder onBind(Intent intent) {\n+        return null;\n+    }\n+\n+    class InitThread extends Thread {\n+        private FileInfo mFileInfo;\n+\n+        public InitThread(FileInfo mFileInfo) {\n+            this.mFileInfo = mFileInfo;\n+        }\n+\n+        @Override\n+        public void run() {\n+            HttpURLConnection conn = null;\n+            RandomAccessFile raf = null;\n+            try {\n+                URL url = new URL(mFileInfo.getUrl());\n+                conn = (HttpURLConnection) url.openConnection();\n+                conn.setConnectTimeout(3000);\n+                conn.setRequestMethod(\"GET\");\n+                int length = -1;\n+                if(conn.getResponseCode() == 200) {\n+                    //获取文件长度\n+                    length = conn.getContentLength();\n+                }\n+                if(length <= 0) {\n+                    return;\n+                }\n+                File dir = new File(DOWNLOAD_PATH);\n+                if(!dir.exists()) {\n+                    dir.mkdir();\n+                }\n+                //在本地创建文件\n+                File file = new File(dir, mFileInfo.getFileName());\n+                raf = new RandomAccessFile(file, \"rwd\");\n+                //设置文件长度\n+                raf.setLength(length);\n+                mFileInfo.setLength(length);\n+                mHandler.obtainMessage(MSG_INIT, mFileInfo).sendToTarget();\n+            } catch (MalformedURLException e) {\n+                e.printStackTrace();\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+            } finally {\n+                try {\n+                    if(raf != null) {\n+                        raf.close();\n+                    }\n+                    conn.disconnect();\n+                } catch (IOException e) {\n+                    e.printStackTrace();\n+                }\n+            }\n+        }\n+    }\n+}"
  }, {
    "sha" : "6022baa943242bff228219e4b8d317c00dcd7e3b",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadTask.java",
    "status" : "added",
    "additions" : 126,
    "deletions" : 0,
    "changes" : 126,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadTask.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadTask.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/DownloadTask.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,126 @@\n+package single_thread_download.skyward.com.service;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+import android.widget.ProgressBar;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.RandomAccessFile;\n+import java.net.HttpURLConnection;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.List;\n+\n+import single_thread_download.skyward.com.bean.FileInfo;\n+import single_thread_download.skyward.com.bean.ThreadInfo;\n+import single_thread_download.skyward.com.db.ThreadDao;\n+import single_thread_download.skyward.com.db.ThreadDaoImpl;\n+\n+/**\n+ * 下载任务类\n+ * Created by skyward on 2016/6/16.\n+ */\n+public class DownloadTask {\n+    private Context mContext = null;\n+    private FileInfo mFileInfo = null;\n+    private ThreadDao mDao = null;\n+    private int mFinished = 0;\n+    public  boolean isPause = false;\n+\n+    public void download() {\n+        //读取数据库的线程信息\n+        List<ThreadInfo> threadInfos = mDao.getThreads(mFileInfo.getUrl());\n+        ThreadInfo threadInfo = null;\n+        if(threadInfos.size() == 0) {\n+            //初始化线程信息对象\n+            threadInfo = new ThreadInfo(0, mFileInfo.getUrl(), 0, mFileInfo.getLength(), 0);\n+        } else {\n+            threadInfo = threadInfos.get(0);\n+        }\n+        //创建子线程进行下载\n+        new DownloadThread(threadInfo).start();\n+    }\n+\n+    public DownloadTask(Context mContext, FileInfo mFileInfo) {\n+        this.mContext = mContext;\n+        this.mFileInfo = mFileInfo;\n+        mDao = new ThreadDaoImpl(mContext);\n+    }\n+\n+    /**\n+     * 下载线程\n+     */\n+    class DownloadThread extends Thread {\n+        private ThreadInfo mThreadInfo = null;\n+\n+        public DownloadThread(ThreadInfo mThreadInfo){\n+            this.mThreadInfo = mThreadInfo;\n+        }\n+\n+        @Override\n+        public void run() {\n+            //向数据库插入线程信息\n+            if(!mDao.isExists(mThreadInfo.getUrl(), mThreadInfo.getId())) {\n+                mDao.insertThread(mThreadInfo);\n+            }\n+            HttpURLConnection conn = null;\n+            RandomAccessFile raf = null;\n+            InputStream in = null;\n+            try {\n+                URL url = new URL(mThreadInfo.getUrl());\n+                conn = (HttpURLConnection) url.openConnection();\n+                conn.setConnectTimeout(3000);\n+                conn.setRequestMethod(\"GET\");\n+                //下载设置\n+                int start = mThreadInfo.getStart() + mThreadInfo.getFinished();\n+                conn.setRequestProperty(\"Range\", \"bytes=\" + start + \"-\" + mThreadInfo.getEnd());\n+                //写入设置\n+                File f = new File(DownloadService.DOWNLOAD_PATH, mFileInfo.getFileName());\n+                raf = new RandomAccessFile(f, \"rwd\");\n+                raf.seek(start);\n+                Intent intent = new Intent(DownloadService.ACTION_UPDATE);\n+                mFinished += mThreadInfo.getFinished();\n+                //开始下载\n+                if(conn.getResponseCode() == 206) {\n+                    //读取数据\n+                    in = conn.getInputStream();\n+                    byte[] buffer = new byte[1024 * 4];\n+                    int len = -1;\n+                    long time = System.currentTimeMillis();\n+                    while((len = in.read(buffer)) != -1) {\n+                        //写入文件\n+                        raf.write(buffer, 0, len);\n+                        //把下载进度广播给Activity\n+                        mFinished += len;\n+                        if(System.currentTimeMillis() - time > 500) {\n+                            time = System.currentTimeMillis();\n+                            intent.putExtra(\"finished\", mFinished * 100 / mFileInfo.getLength());\n+                            mContext.sendBroadcast(intent);\n+                        }\n+                        //在下载暂停时，保存下载进度\n+                        if(isPause) {\n+                            mDao.updateThread(mThreadInfo.getUrl(), mThreadInfo.getId(), mFinished);\n+                            return;\n+                        }\n+                    }\n+                    //删除线程信息\n+                    mDao.deleteThread(mThreadInfo.getUrl(), mThreadInfo.getId());\n+                }\n+            } catch (MalformedURLException e) {\n+                e.printStackTrace();\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+            } finally {\n+                try {\n+                    conn.disconnect();\n+                    raf.close();\n+                    in.close();\n+                } catch (IOException e) {\n+                    e.printStackTrace();\n+                }\n+            }\n+        }\n+    }\n+}"
  }, {
    "sha" : "5c866396ebd8057daf49586a3ce8b3c0b9dbe124",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/FileInfo.java",
    "status" : "added",
    "additions" : 81,
    "deletions" : 0,
    "changes" : 81,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/FileInfo.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/FileInfo.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/FileInfo.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,81 @@\n+package single_thread_download.skyward.com.bean;\n+\n+import java.io.Serializable;\n+\n+/**\n+ * Created by skyward on 2016/5/30.\n+ */\n+public class FileInfo implements Serializable{\n+    //编号\n+    private int id;\n+    //文件名\n+    private String fileName;\n+    //文件大小\n+    private int length;\n+    //下载链接\n+    private String url;\n+    //已下载文件大小\n+    private int finished;\n+\n+    public FileInfo(int id,  String url, String fileName, int length, int finished) {\n+        this.id = id;\n+        this.fileName = fileName;\n+        this.length = length;\n+        this.url = url;\n+        this.finished = finished;\n+    }\n+\n+    public FileInfo() {\n+    }\n+\n+    public int getId() {\n+        return id;\n+    }\n+\n+    public void setId(int id) {\n+        this.id = id;\n+    }\n+\n+    public String getFileName() {\n+        return fileName;\n+    }\n+\n+    public void setFileName(String fileName) {\n+        this.fileName = fileName;\n+    }\n+\n+    public int getLength() {\n+        return length;\n+    }\n+\n+    public void setLength(int length) {\n+        this.length = length;\n+    }\n+\n+    public String getUrl() {\n+        return url;\n+    }\n+\n+    public void setUrl(String url) {\n+        this.url = url;\n+    }\n+\n+    public int getFinished() {\n+        return finished;\n+    }\n+\n+    public void setFinished(int finished) {\n+        this.finished = finished;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"FileInfo{\" +\n+                \"id=\" + id +\n+                \", fileName='\" + fileName + '\\'' +\n+                \", length=\" + length +\n+                \", url='\" + url + '\\'' +\n+                \", finished=\" + finished +\n+                '}';\n+    }\n+}"
  }, {
    "sha" : "1edaedd592b8516f5098ab55da5191e0552fa7d8",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/MainActivity.java",
    "status" : "added",
    "additions" : 125,
    "deletions" : 0,
    "changes" : 125,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/MainActivity.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/MainActivity.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/MainActivity.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,125 @@\n+package single_thread_download.skyward.com;\n+\n+import android.content.BroadcastReceiver;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.content.IntentFilter;\n+import android.support.v7.app.AppCompatActivity;\n+import android.os.Bundle;\n+import android.util.Log;\n+import android.view.View;\n+import android.widget.Button;\n+import android.widget.ProgressBar;\n+import android.widget.TextView;\n+\n+import java.util.List;\n+\n+import single_thread_download.skyward.com.bean.FileInfo;\n+import single_thread_download.skyward.com.bean.ThreadInfo;\n+import single_thread_download.skyward.com.db.ThreadDao;\n+import single_thread_download.skyward.com.db.ThreadDaoImpl;\n+import single_thread_download.skyward.com.service.DownloadService;\n+\n+public class MainActivity extends AppCompatActivity {\n+    private ProgressBar pb_progress;\n+    private Button bt_operation;\n+    private TextView tv_fileName;\n+    private TextView tv_state;\n+    //默认值为初态\n+    private int state = 0;\n+\n+    /**\n+     * 下载状态\n+     * 根据下载状态改变按钮文本内容，并执行不同操作\n+     * 0：初态\n+     * 按钮的文本内容为“下载”\n+     * 当用户按下按钮后，根据url开始下载文件，同时将按钮的文本内容改为“停止”，bt_state改为1，进入正在下载状态\n+     * 1：正在下载状态\n+     * 按钮文本内容为“停止”\n+     * 当用户按下按钮后，执行停止下载操作，同时将按钮的文本内容改为“继续下载”，bt_state改为2，进入停止下载状态\n+     * 2：停止下载状态\n+     * 按钮文本内容“继续下载”\n+     * 当用户按下按钮后，从上一次下载的位置开始下载，同时将按钮的文本内容改为“停止”，bt_state改为1，进入正在下载状态\n+     * 3.下载完成\n+     * 当文件下载完成时，将按钮内容改为“下载已完成”。同时将按钮设为不可点击。\n+     */\n+    public static final int START = 0;\n+    public static final int DOWNLOADING = 1;\n+    public static final int STOP = 2;\n+    public static final int FINISH = 3;\n+\n+    BroadcastReceiver mReceiver = new BroadcastReceiver() {\n+        @Override\n+        public void onReceive(Context context, Intent intent) {\n+            if(DownloadService.ACTION_UPDATE.equals(intent.getAction())) {\n+                int finished = intent.getIntExtra(\"finished\", 0);\n+                pb_progress.setProgress(finished);\n+            }\n+        }\n+    };\n+\n+\n+\n+    @Override\n+    protected void onCreate(Bundle savedInstanceState) {\n+        super.onCreate(savedInstanceState);\n+        setContentView(R.layout.activity_net1314080903223);\n+        pb_progress = (ProgressBar) findViewById(R.id.pb_progress);\n+        bt_operation = (Button) findViewById(R.id.bt_operation);\n+        tv_state = (TextView) findViewById(R.id.tv_state);\n+        tv_fileName = (TextView) findViewById(R.id.tv_fileName);\n+\n+        final FileInfo fileInfo = new FileInfo(0, \"http://dl.ad-safe.com/adsafe_v4/download/adsafe.v4.2.507.1201.exe\", \"adsafe.exe\",0, 0);\n+        Intent intent = new Intent(MainActivity.this, DownloadService.class);\n+        bt_operation.setOnClickListener(new View.OnClickListener() {\n+            @Override\n+            public void onClick(View v) {\n+                Intent intent = new Intent(MainActivity.this, DownloadService.class);\n+                switch (state) {\n+                    //初态：开始下载操作，\n+                    case START:\n+                        bt_operation.setText(\"停止\");\n+                        tv_state.setText(\"正在下载\");\n+                        intent.setAction(DownloadService.ACTION_START);\n+                        intent.putExtra(\"fileInfo\", fileInfo);\n+                        startService(intent);\n+                        state = DOWNLOADING;\n+                        break;\n+                    //正在下载状态：停止下载操作，进入停止下载状态\n+                    case DOWNLOADING:\n+                        bt_operation.setText(\"继续下载\");\n+                        tv_state.setText(\"停止下载\");\n+                        intent.setAction(DownloadService.ACTION_STOP);\n+                        intent.putExtra(\"fileInfo\", fileInfo);\n+                        startService(intent);\n+                        state = STOP;\n+                        break;\n+                    //停止下载状态：从上次下载位置继续下载文件，进入正在下载状态\n+                    case STOP:\n+                        bt_operation.setText(\"停止\");\n+                        tv_state.setText(\"正在下载\");\n+                        intent.setAction(DownloadService.ACTION_START);\n+                        intent.putExtra(\"fileInfo\", fileInfo);\n+                        startService(intent);\n+                        state = DOWNLOADING;\n+                        break;\n+                    case FINISH:\n+                        bt_operation.setText(\"下载已完成\");\n+                        bt_operation.setEnabled(false);\n+                        tv_state.setText(\"下载已完成\");\n+                        break;\n+                }\n+            }\n+        });\n+        //注册广播接收者\n+        IntentFilter filter = new IntentFilter();\n+        filter.addAction(DownloadService.ACTION_UPDATE);\n+        registerReceiver(mReceiver, filter);\n+    }\n+\n+    @Override\n+    protected void onDestroy() {\n+        super.onDestroy();\n+        unregisterReceiver(mReceiver);\n+    }\n+}"
  }, {
    "sha" : "0dbd3ede5c5d244f42995b2879c3a6c9ba67983e",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/Net1314080903223Activity.java",
    "status" : "added",
    "additions" : 37,
    "deletions" : 0,
    "changes" : 37,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/Net1314080903223Activity.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/Net1314080903223Activity.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/Net1314080903223Activity.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,37 @@\n+package single_thread_download.skyward.com;\n+\n+import android.content.BroadcastReceiver;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.content.IntentFilter;\n+import android.support.v7.app.AppCompatActivity;\n+import android.os.Bundle;\n+import android.util.Log;\n+import android.view.View;\n+import android.widget.Button;\n+import android.widget.ProgressBar;\n+import android.widget.TextView;\n+\n+import java.util.List;\n+\n+import single_thread_download.skyward.com.bean.FileInfo;\n+import single_thread_download.skyward.com.bean.ThreadInfo;\n+import single_thread_download.skyward.com.db.ThreadDao;\n+import single_thread_download.skyward.com.db.ThreadDaoImpl;\n+import single_thread_download.skyward.com.service.DownloadService;\n+\n+public class Net1314080903223Activity extends AppCompatActivity {\n+\n+    @Override\n+    protected void onCreate(Bundle savedInstanceState) {\n+        super.onCreate(savedInstanceState);\n+        setContentView(R.layout.activity_net1314080903223);\n+        pb_progress = (ProgressBar) findViewById(R.id.pb_progress);\n+        bt_operation = (Button) findViewById(R.id.bt_operation);\n+        tv_state = (TextView) findViewById(R.id.tv_state);\n+        tv_fileName = (TextView) findViewById(R.id.tv_fileName);\n+\n+      \n+    }\n+\n+}"
  }, {
    "sha" : "cec0cb33cfb89a04ab2a632e242227d69c26d436",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDao.java",
    "status" : "added",
    "additions" : 46,
    "deletions" : 0,
    "changes" : 46,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDao.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDao.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDao.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,46 @@\n+package single_thread_download.skyward.com.db;\n+\n+import java.util.List;\n+\n+import single_thread_download.skyward.com.bean.ThreadInfo;\n+\n+/**\n+ * 数据访问接口\n+ * Created by skyward on 2016/6/15.\n+ */\n+public interface ThreadDao {\n+    /**\n+     * 插入线程信息\n+     */\n+    public void insertThread(ThreadInfo threadInfo);\n+\n+    /**\n+     * 删除线程\n+     * @param url\n+     * @param thread_id\n+     */\n+    public void deleteThread(String url, int thread_id);\n+\n+    /**\n+     * 更新线程下载进度\n+     * @param url\n+     * @param thread_id\n+     * @param finished\n+     */\n+    public void updateThread(String url, int thread_id, int finished);\n+\n+    /**\n+     * 查询线程信息\n+     * @param url\n+     * @return\n+     */\n+    public List<ThreadInfo> getThreads(String url);\n+\n+    /**\n+     * 线程信息是否已存在\n+     * @param url\n+     * @param thread_id\n+     * @return\n+     */\n+    public boolean isExists(String url, int thread_id);\n+}"
  }, {
    "sha" : "2ffbe42c4b3349e84263a641362a109e72b9cd7d",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDaoImpl.java",
    "status" : "added",
    "additions" : 78,
    "deletions" : 0,
    "changes" : 78,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDaoImpl.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDaoImpl.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadDaoImpl.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,78 @@\n+package single_thread_download.skyward.com.db;\n+\n+import android.content.Context;\n+import android.database.Cursor;\n+import android.database.sqlite.SQLiteDatabase;\n+import android.util.Log;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import single_thread_download.skyward.com.bean.ThreadInfo;\n+\n+/**\n+ * 数据库访问接口的实现\n+ * Created by skyward on 2016/6/15.\n+ */\n+public class ThreadDaoImpl implements ThreadDao {\n+    private DBHelper mHelper = null;\n+\n+    public ThreadDaoImpl(Context context) {\n+        mHelper = new DBHelper(context);\n+    }\n+\n+    @Override\n+    public void insertThread(ThreadInfo threadInfo) {\n+        if (mHelper == null) {\n+            Log.i(\"jkf\", \"insertThread: \" + \"坑爹的空指针\");\n+            return;\n+        }\n+        SQLiteDatabase db = mHelper.getWritableDatabase();\n+        db.execSQL(\"insert into thread_info(thread_id,url,start,end,finished) values(?,?,?,?,?)\", new Object[]{\n+                threadInfo.getId(), threadInfo.getUrl(), threadInfo.getStart(), threadInfo.getEnd(), threadInfo.getFinished()\n+        });\n+        db.close();\n+    }\n+\n+    @Override\n+    public void deleteThread(String url, int thread_id) {\n+        SQLiteDatabase db = mHelper.getWritableDatabase();\n+        db.execSQL(\"delete from thread_info where url = ? and thread_id = ?\", new Object[]{url, thread_id});\n+        db.close();\n+    }\n+\n+    @Override\n+    public void updateThread(String url, int thread_id, int finished) {\n+        SQLiteDatabase db = mHelper.getWritableDatabase();\n+        db.execSQL(\"update thread_info set finished = ? where url = ? and thread_id = ?\", new Object[]{finished, url, thread_id});\n+        db.close();\n+    }\n+\n+    @Override\n+    public List<ThreadInfo> getThreads(String url) {\n+        SQLiteDatabase db = mHelper.getWritableDatabase();\n+        List<ThreadInfo> list = new ArrayList<>();\n+        Cursor cursor = db.rawQuery(\"select * from thread_info where url = ?\", new String[]{url});\n+        while(cursor.moveToNext()) {\n+            ThreadInfo threadInfo = new ThreadInfo();\n+            threadInfo.setId(cursor.getInt(cursor.getColumnIndex(\"thread_id\")));\n+            threadInfo.setUrl(url);\n+            threadInfo.setStart(cursor.getInt(cursor.getColumnIndex(\"start\")));\n+            threadInfo.setEnd(cursor.getInt(cursor.getColumnIndex(\"end\")));\n+            threadInfo.setFinished(cursor.getInt(cursor.getColumnIndex(\"finished\")));\n+            list.add(threadInfo);\n+        }\n+        db.close();\n+        return list;\n+    }\n+\n+    @Override\n+    public boolean isExists(String url, int thread_id) {\n+        SQLiteDatabase db = mHelper.getWritableDatabase();\n+        Cursor cursor = db.rawQuery(\"select * from thread_info where url = ? and thread_id = ?\", new String[]{url, thread_id + \"\"});\n+        boolean exists = cursor.moveToNext();\n+        cursor.close();\n+        db.close();\n+        return false;\n+    }\n+}"
  }, {
    "sha" : "a2cfbafe0003d51cf26b67d9cb1299d427bf73b7",
    "filename" : "app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadInfo.java",
    "status" : "added",
    "additions" : 81,
    "deletions" : 0,
    "changes" : 81,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadInfo.java",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadInfo.java",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/java/edu/hzuapps/androidworks/homeworks/net1314080903223/ThreadInfo.java?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,81 @@\n+package single_thread_download.skyward.com.bean;\n+\n+/**\n+ * 线程信息实体类\n+ * Created by skyward on 2016/5/30.\n+ */\n+public class ThreadInfo {\n+    //编号\n+    private int id;\n+    //下载链接\n+    private String url;\n+    //下载的起始位置（字节）\n+    private int start;\n+    //下载的结束位置\n+    private int end;\n+    //已下载完成的大小\n+    private int finished;\n+\n+    @Override\n+    public String toString() {\n+        return \"ThreadInfo{\" +\n+                \"id=\" + id +\n+                \", url='\" + url + '\\'' +\n+                \", start=\" + start +\n+                \", end=\" + end +\n+                \", finished=\" + finished +\n+                '}';\n+    }\n+\n+    public int getId() {\n+        return id;\n+    }\n+\n+    public void setId(int id) {\n+        this.id = id;\n+    }\n+\n+    public String getUrl() {\n+        return url;\n+    }\n+\n+    public void setUrl(String url) {\n+        this.url = url;\n+    }\n+\n+    public int getStart() {\n+        return start;\n+    }\n+\n+    public void setStart(int start) {\n+        this.start = start;\n+    }\n+\n+    public int getEnd() {\n+        return end;\n+    }\n+\n+    public void setEnd(int end) {\n+        this.end = end;\n+    }\n+\n+    public int getFinished() {\n+        return finished;\n+    }\n+\n+    public void setFinished(int finished) {\n+        this.finished = finished;\n+    }\n+\n+    public ThreadInfo() {\n+\n+    }\n+\n+    public ThreadInfo(int id, String url, int start, int end, int finished) {\n+        this.id = id;\n+        this.url = url;\n+        this.start = start;\n+        this.end = end;\n+        this.finished = finished;\n+    }\n+}"
  }, {
    "sha" : "2fad9d510f72a84cad44d390ac45a50b62e0e48c",
    "filename" : "app/src/main/res/layout/activity_net1314080903223.xml",
    "status" : "added",
    "additions" : 39,
    "deletions" : 0,
    "changes" : 39,
    "blob_url" : "https://github.com/hzuapps/android-labs/blob/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/res/layout/activity_net1314080903223.xml",
    "raw_url" : "https://github.com/hzuapps/android-labs/raw/1c4dd09b3992c3b72491ca312a6b0198b60db831/app/src/main/res/layout/activity_net1314080903223.xml",
    "contents_url" : "https://api.github.com/repos/hzuapps/android-labs/contents/app/src/main/res/layout/activity_net1314080903223.xml?ref=1c4dd09b3992c3b72491ca312a6b0198b60db831",
    "patch" : "@@ -0,0 +1,39 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    tools:context=\"single_thread_download.skyward.com.MainActivity\">\n+    <TextView\n+        android:layout_marginTop=\"10dp\"\n+        android:layout_marginLeft=\"10dp\"\n+        android:id=\"@+id/tv_fileName\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\" />\n+    <TextView\n+        android:layout_marginTop=\"10dp\"\n+        android:layout_marginRight=\"10dp\"\n+        android:layout_alignParentRight=\"true\"\n+        android:id=\"@+id/tv_state\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\" />\n+\n+    <ProgressBar\n+        android:id=\"@+id/pb_progress\"\n+        android:layout_below=\"@id/tv_fileName\"\n+        android:layout_marginTop=\"10dp\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:max=\"100\"\n+        style=\"?android:attr/progressBarStyleHorizontal\"\n+        />\n+\n+    <Button\n+        android:layout_marginRight=\"10dp\"\n+        android:layout_below=\"@id/pb_progress\"\n+        android:layout_alignParentRight=\"true\"\n+        android:id=\"@+id/bt_operation\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:text=\"下载\"/>\n+</RelativeLayout>"
  } ],
  "sha" : "1c4dd09b3992c3b72491ca312a6b0198b60db831",
  "url" : "https://api.github.com/repos/hzuapps/android-labs/commits/1c4dd09b3992c3b72491ca312a6b0198b60db831",
  "parents" : [ {
    "sha" : "ed6f7f827f3e862acfa0d5747be96f13072898af",
    "url" : "https://api.github.com/repos/hzuapps/android-labs/commits/ed6f7f827f3e862acfa0d5747be96f13072898af",
    "html_url" : "https://github.com/hzuapps/android-labs/commit/ed6f7f827f3e862acfa0d5747be96f13072898af"
  }, {
    "sha" : "d86aebd5cc9a56db339815d4cd4197bee7c3bc65",
    "url" : "https://api.github.com/repos/hzuapps/android-labs/commits/d86aebd5cc9a56db339815d4cd4197bee7c3bc65",
    "html_url" : "https://github.com/hzuapps/android-labs/commit/d86aebd5cc9a56db339815d4cd4197bee7c3bc65"
  } ]
}